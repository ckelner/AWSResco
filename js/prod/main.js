function n(){K=[],M=[],clearInterval(H),H=null}function e(e,s){if(null!=e&&null!=s){d(),n();for(var a=0;a<_.length;a++)o(_[a],e,s,!1),o(_[a],e,s,!0);H=setInterval(t,1e3)}}function t(){K.length==_.length&&M.length==_.length&&(clearInterval(H),u(a(K,M)))}function s(n){for(var e=n.length,t=[],s=0;e>s;s++)Array.prototype.push.apply(t,n[s].data);return t}function a(n,e){n=s(n),e=s(e);for(var t=e.length,a=[],o=0,r={},i=0;t>i;i++){var c=e[i],l=c.type+c.az+c.windows+c.vpc;null==a[l]&&(r[l]=o,a[o]=c,o++);for(var u=0;t>u;u++){var d=e[u];c.type==d.type&&c.az==d.az&&c.windows==d.windows&&c.vpc==d.vpc&&i!=u&&(a[r[l]].count+=d.count,Array.prototype.push.apply(a[r[l]].resIds,d.resIds))}}for(var v=n.length,f=0;v>f;f++){for(var p=a.length,g=n[f],y=!1,I=0;p>I;I++){var w=a[I];if(null==a[I].running&&(a[I].running=0,a[I].running_ids=[],a[I].running_names=[],a[I].diff=0-a[I].count),g.type==w.type&&g.az==w.az&&g.windows==w.windows&&g.vpc==w.vpc){a[I].running+=1,a[I].diff=a[I].count-a[I].running,a[I].running_ids.push(g.id),void 0!=g.name&&null!=g.name&&""!=g.name&&a[I].running_names.push(g.name),y=!0;break}}if(y===!1){var m={};m.running=1,m.running_ids=[g.id],m.running_names=[],void 0!=g.name&&null!=g.name&&""!=g.name&&m.running_names.push(g.name),m.diff=-1,m.resIds=[],m.type=g.type,m.count=0,m.az=g.az,m.cost=0,m.windows=g.windows,m.vpc=g.vpc,a.push(m)}}return a}function o(n,e,t,s){var a=new AWS.EC2({accessKeyId:e,secretAccessKey:t,region:n,maxRetries:5,sslEnabled:!0});if(s){var o={Filters:[{Name:"state",Values:["active"]}]};a.describeReservedInstances(o,function(e,t){r(e,t,n,s)})}else{var o={Filters:[{Name:"instance-state-name",Values:["running"]}],MaxResults:1e3};a.describeInstances(o,function(e,t){r(e,t,n,s)})}}function r(n,e,t,s){n?(console.log(n,n.stack),v("<b><font color='red'>The following error has occured: "+n+"; see the javascript console for more details.</font></b>")):i(e,t,s)}function i(n,e,t){t?M.push({region:e,data:c(n)}):K.push({region:e,data:l(n)})}function c(n){var e=[];if(!n||!n.ReservedInstances||0==n.ReservedInstances.length)return e;for(var t=n.ReservedInstances.length,s=0;t>s;s++)e[s]={},e[s].resIds=[n.ReservedInstances[s].ReservedInstancesId],e[s].type=n.ReservedInstances[s].InstanceType,e[s].count=n.ReservedInstances[s].InstanceCount,e[s].az=n.ReservedInstances[s].AvailabilityZone,e[s].cost=n.ReservedInstances[s].RecurringCharges[0].Amount,-1!=n.ReservedInstances[s].ProductDescription.toLowerCase().indexOf("windows")?e[s].windows=!0:e[s].windows=!1,-1!=n.ReservedInstances[s].ProductDescription.toLowerCase().indexOf("vpc")?e[s].vpc=!0:e[s].vpc=!1;return e}function l(n){var e=[];if(!n||!n.Reservations||0==n.Reservations.length)return e;for(var t=n.Reservations.length,s=0;t>s;s++){var a=n.Reservations[s].Instances[0].Tags,o="";if(a.length>1)for(var r=a.length,i=0;r>i;i++)try{if(null!=a[i].Key)a[i].Key.toLowerCase()=="aws:autoscaling:groupName".toLowerCase()&&""==o&&(o=a[i].Value),"name"==a[i].Key.toLowerCase()&&(o=a[i].Value);else try{console.log("Tags["+i+"] empty: "+a.toString())}catch(n){console.log("Exception Id 00x1")}}catch(n){console.log("Exception Id 00x3")}else if(1==a.length)o=a[0].Value;else try{console.log("No name tag found for instance with id: "+n.Reservations[s].Instances[0].InstanceId)}catch(n){console.log("Exception Id 00x2")}e[s]={},e[s].name=o,e[s].id=n.Reservations[s].Instances[0].InstanceId,e[s].type=n.Reservations[s].Instances[0].InstanceType,e[s].az=n.Reservations[s].Instances[0].Placement.AvailabilityZone;try{void 0!=n.Reservations[s].Instances[0].Platform&&null!=n.Reservations[s].Instances[0].Platform&&"windows"==n.Reservations[s].Instances[0].Platform.toLowerCase()?e[s].windows=!0:e[s].windows=!1}catch(n){console.log("Exception Id 00x4")}null!=n.Reservations[s].Instances[0].VpcId&&""!=n.Reservations[s].Instances[0].VpcId?e[s].vpc=!0:e[s].vpc=!1}return e}function u(n){b().innerHTML="",b().innerHTML+=f(n),Sortable.init(),w(),E()}function d(){x(),b().innerHTML=""}function v(n){b().innerHTML=n}function f(n){for(var e="",t=n.length,s=0;t>s;s++)e+="<tr><th scope='row'>"+n[s].count+"</th><td>"+n[s].running+"</th><td>"+n[s].diff+"</th><td>"+n[s].type+"</td><td>"+n[s].az+"</td><td>"+n[s].windows.toString()+"</td><td>"+n[s].vpc.toString()+"</td><td>"+n[s].running_ids.join(",<br/>")+"</td><td>"+n[s].running_names.join(",<br/>")+"</td></tr>";return e}function p(){P=setInterval(g,1e3)}function g(){-1==y().innerHTML.toLowerCase().indexOf("please wait.....")?y().innerHTML+=".":y().innerHTML="Please Wait"}function y(){return document.getElementById("pleaseWait")}function I(){p(),y().style.display="block"}function w(){clearInterval(P),y().style.display="none"}function m(){return document.getElementById("errorAccessSecretKey")}function h(){w(),m().style.display="block"}function R(){m().style.display="none"}function b(){return document.getElementById("ec2DataTableBody")}function L(){return document.getElementById("awsQueryResults")}function E(){L().style.display="block"}function x(){L().style.display="none"}function T(){document.getElementById("awsQueryButton").addEventListener("click",function(){B()})}function z(n){return void 0==n||null==n||""==n?(h(),null):n}function C(){return z(document.getElementById("awsAccessKey").value)}function A(){return z(document.getElementById("awsSecretKey").value)}function B(){return I(),R(),e(C(),A()),!1}var _=["us-east-1","us-west-1","us-west-2","eu-west-1","eu-central-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","sa-east-1"],K=[],M=[],H=null,P=null;window.onload=function(){T()};