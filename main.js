function e(){F=[],M=[],clearInterval(V),V=null}function n(n,s,r){if(null!=n&&null!=s){if(K=r,f(),e(),-1!=r.indexOf(_))for(var a=0;a<k.length;a++)o(k[a],n,s,!1),o(k[a],n,s,!0);else o(K,n,s,!1),o(K,n,s,!0);V=setInterval(t,1e3)}}function t(){-1!=K.indexOf(_)?F.length==k.length&&M.length==k.length&&(clearInterval(V),u(r(F,M))):F.length>0&&M.length>0&&(clearInterval(V),u(r(F,M)))}function s(e){for(var n=e.length,t=[],s=0;n>s;s++)Array.prototype.push.apply(t,e[s].data);return t}function r(e,n){for(var t=s(e),r=s(n),o=r.length,a=[],i=0,c={},l=[],u=0;o>u;u++){var d=JSON.parse(JSON.stringify(r[u])),f=d.type+d.az+d.windows+d.vpc;if(!l.contains(f)){void 0===c[f]&&(c[f]=i,l.push(f),a[i]=JSON.parse(JSON.stringify(d)),i++);for(var p=u+1;o>p;p++){var v=JSON.parse(JSON.stringify(r[p]));d.type===v.type&&d.az===v.az&&d.windows===v.windows&&d.vpc===v.vpc&&u!==p&&v!==d&&(a[c[f]].count+=v.count,Array.prototype.push.apply(a[c[f]].resIds,v.resIds))}}}for(var g=t.length,h=0;g>h;h++){for(var w=a.length,m=t[h],y=!1,b=0;w>b;b++){null==a[b].running&&(a[b].running=0,a[b].running_ids=[],a[b].running_names=[],a[b].diff=a[b].count);var I=a[b];if(m.type==I.type&&m.az==I.az&&m.windows==I.windows&&m.vpc==I.vpc){a[b].running+=1,a[b].diff-=1,a[b].running_ids.push(m.id),void 0!=m.name&&null!=m.name&&""!=m.name&&a[b].running_names.push(m.name),y=!0;break}}if(y===!1){var x={};x.running=1,x.running_ids=[m.id],x.running_names=[],void 0!=m.name&&null!=m.name&&""!=m.name&&x.running_names.push(m.name),x.diff=-1,x.resIds=[],x.type=m.type,x.count=0,x.az=m.az,x.cost=0,x.windows=m.windows,x.vpc=m.vpc,a.push(x)}}return a}function o(e,n,t,s){var r=new AWS.EC2({accessKeyId:n,secretAccessKey:t,region:e,maxRetries:5,sslEnabled:!0});if(s){var o={Filters:[{Name:"state",Values:["active"]}]};r.describeReservedInstances(o,function(n,t){a(n,t,e,s)})}else{var o={Filters:[{Name:"instance-state-name",Values:["running"]}],MaxResults:1e3};r.describeInstances(o,function(n,t){a(n,t,e,s)})}}function a(e,n,t,s){e?(console.log(e,e.stack),p("<b><font color='red'>The following error has occured: "+e+"; see the javascript console for more details.</font></b>")):i(n,t,s)}function i(e,n,t){t?M.push({region:n,data:c(e)}):F.push({region:n,data:l(e)})}function c(e){var n=[];if(!e||!e.ReservedInstances||0==e.ReservedInstances.length)return n;for(var t=e.ReservedInstances.length,s=0;t>s;s++)n[s]={},n[s].resIds=[e.ReservedInstances[s].ReservedInstancesId],n[s].type=e.ReservedInstances[s].InstanceType,n[s].count=e.ReservedInstances[s].InstanceCount,n[s].az=e.ReservedInstances[s].AvailabilityZone,e.ReservedInstances[s].RecurringCharges[0]&&(n[s].cost=e.ReservedInstances[s].RecurringCharges[0].Amount),-1!=e.ReservedInstances[s].ProductDescription.toLowerCase().indexOf("windows")?n[s].windows=!0:n[s].windows=!1,-1!=e.ReservedInstances[s].ProductDescription.toLowerCase().indexOf("vpc")?n[s].vpc=!0:n[s].vpc=!1;return n}function l(e){var n=[];if(!e||!e.Reservations||0==e.Reservations.length)return n;for(var t=e.Reservations.length,s=0,r=0;t>r;r++)for(var o=0;o<e.Reservations[r].Instances.length;o++){var a=e.Reservations[r].Instances[o].Tags,i="";if(a.length>1)for(var c=a.length,l=0;c>l;l++)try{if(null!=a[l].Key)a[l].Key.toLowerCase()=="aws:autoscaling:groupName".toLowerCase()&&""==i&&(i=a[l].Value),"name"==a[l].Key.toLowerCase()&&(i=a[l].Value);else try{console.log("Tags["+l+"] empty: "+a.toString())}catch(e){console.log("Exception Id 00x1")}}catch(e){console.log("Exception Id 00x3")}else if(1==a.length)i=a[0].Value;else try{console.log("No name tag found for instance with id: "+e.Reservations[r].Instances[o].InstanceId)}catch(e){console.log("Exception Id 00x2")}n[s]={},n[s].name=i,n[s].id=e.Reservations[r].Instances[o].InstanceId,n[s].type=e.Reservations[r].Instances[o].InstanceType,n[s].az=e.Reservations[r].Instances[o].Placement.AvailabilityZone;try{void 0!=e.Reservations[r].Instances[o].Platform&&null!=e.Reservations[r].Instances[0].Platform&&"windows"==e.Reservations[r].Instances[o].Platform.toLowerCase()?n[s].windows=!0:n[s].windows=!1}catch(e){console.log("Exception Id 00x4")}null!=e.Reservations[r].Instances[o].VpcId&&""!=e.Reservations[r].Instances[o].VpcId?n[s].vpc=!0:n[s].vpc=!1,s++}return n}function u(e){E().innerHTML="",E().innerHTML+=v(e),w().innerHTML="<b>Total Reservations: "+D+" --- Total Running Instances: "+J+" --- <button id='downloadAsCSV' onClick='getTableDataAsCSV()' class='btn btn-primary'>Download Data as CSV</button><br><hr>",new Tablesort(document.getElementById("resCoTable")),document.getElementById("differentialHeader").click(),b(),T()}function d(){for(var e="<form class='form-inline' id='zoneForm'>",n=0;n<j.length;n++)e+="<div class='checkbox'><label><input type='checkbox' name='"+j[n]+"'>"+j[n]+"</input></label></div>&nbsp;&nbsp;&nbsp;&nbsp;";return e+="<button id='zoneSelectButton' type='submit' class='btn btn-success'>Filter</button></form>"}function f(){C(),E().innerHTML="",w().innerHTML="",D=0,J=0}function p(e){E().innerHTML=e}function v(e){for(var n="",t=e.length,s=0;t>s;s++)n+="<tr><th scope='row'>"+e[s].count+"</th><td>"+e[s].running+"</th><td>"+e[s].diff+"</th><td>"+e[s].type+"</td><td>"+e[s].az+"</td><td>"+e[s].windows.toString()+"</td><td>"+e[s].vpc.toString()+"</td><td>"+e[s].running_ids.join(",<br/>")+"</td><td>"+e[s].running_names.join(",<br/>")+"</td></tr>",D+=e[s].count,J+=e[s].running,j.contains(e[s].az)||j.push(e[s].az);return n}function g(){P=setInterval(h,1e3)}function h(){-1==m().innerHTML.toLowerCase().indexOf("please wait.....")?m().innerHTML+=".":m().innerHTML="Please Wait"}function w(){return document.getElementById("totalData")}function m(){return document.getElementById("pleaseWait")}function y(){g(),m().style.display="block"}function b(){clearInterval(P),m().style.display="none"}function I(){return document.getElementById("errorAccessSecretKey")}function x(){b(),I().style.display="block"}function L(){I().style.display="none"}function E(){return document.getElementById("ec2DataTableBody")}function R(){return document.getElementById("awsQueryResults")}function T(){R().style.display="block"}function C(){R().style.display="none"}function B(){for(var e,n=document.getElementById("resCoTable"),t="data:text/csv;charset=utf-8,",s=0;e=n.rows[s];s++){for(var r,o=0;r=e.cells[o];o++){o>0&&(t+=",");var a=r.innerHTML.toString().trim();(a.indexOf(",")>=0||a.indexOf('"')>=0||a.indexOf("\n")>=0)&&(a='"'+a.replace(/\"/g,'""')+'"'),a.indexOf("<br>")>=0&&(a=a.replace(/<br>/g,"")),t+=a}t+="\n"}window.open(encodeURI(t))}function S(){document.getElementById("awsQueryButton").addEventListener("click",function(){z()})}function A(e){return void 0==e||null==e||""==e?(x(),null):e}function H(){return A(document.getElementById("awsAccessKey").value)}function N(){return A(document.getElementById("awsSecretKey").value)}function O(){return document.getElementById("regionSelect").value}function z(){return y(),L(),n(H(),N(),O()),!1}var k=["us-east-1","us-west-1","us-west-2","eu-west-1","eu-central-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","sa-east-1"],F=[],M=[],V=null,_="ALL",K="ALL",P=null,D=0,J=0,j=[];String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),window.onload=function(){S()},Array.prototype.contains=function(e){for(var n=this.length;n--;)if(this[n]===e)return!0;return!1},!function(){function e(n,t){if(!(this instanceof e))return new e(n,t);if(!n||"TABLE"!==n.tagName)throw new Error("Element must be a table");this.init(n,t||{})}var n=[],t=function(e){var n;return window.CustomEvent&&"function"==typeof window.CustomEvent?n=new CustomEvent(e):(n=document.createEvent("CustomEvent"),n.initCustomEvent(e,!1,!1,void 0)),n},s=function(e){return e.getAttribute("data-sort")||e.textContent||e.innerText||""},r=function(e,n){return e=e.toLowerCase(),n=n.toLowerCase(),e===n?0:n>e?1:-1},o=function(e,n){return function(t,s){var r=e(t.td,s.td);return 0===r?n?s.index-t.index:t.index-s.index:r}};e.extend=function(e,t,s){if("function"!=typeof t||"function"!=typeof s)throw new Error("Pattern and sort must be a function");n.push({name:e,pattern:t,sort:s})},e.prototype={init:function(e,n){var t,s,r,o,a=this;if(a.table=e,a.thead=!1,a.options=n,e.rows&&e.rows.length>0&&(e.tHead&&e.tHead.rows.length>0?(t=e.tHead.rows[e.tHead.rows.length-1],a.thead=!0):t=e.rows[0]),t){var i=function(){a.current&&a.current!==this&&(a.current.classList.remove("sort-up"),a.current.classList.remove("sort-down")),a.current=this,a.sortTable(this)};for(r=0;r<t.cells.length;r++)o=t.cells[r],o.classList.contains("no-sort")||(o.classList.add("sort-header"),o.tabindex=0,o.addEventListener("click",i,!1),o.classList.contains("sort-default")&&(s=o));s&&(a.current=s,a.sortTable(s))}},sortTable:function(e,a){var i,c=this,l=e.cellIndex,u=r,d="",f=[],p=c.thead?0:1,v=e.getAttribute("data-sort-method"),g=e.getAttribute("data-sort-order");if(c.table.dispatchEvent(t("beforeSort")),a?i=e.classList.contains("sort-up")?"sort-up":"sort-down":(i=e.classList.contains("sort-up")?"sort-down":e.classList.contains("sort-down")?"sort-up":"asc"===g?"sort-down":"desc"===g?"sort-up":c.options.descending?"sort-up":"sort-down",e.classList.remove("sort-down"===i?"sort-up":"sort-down"),e.classList.add(i)),!(c.table.rows.length<2)){if(!v){for(;f.length<3&&p<c.table.tBodies[0].rows.length;)d=s(c.table.tBodies[0].rows[p].cells[l]),d=d.trim(),d.length>0&&f.push(d),p++;if(!f)return}for(p=0;p<n.length;p++)if(d=n[p],v){if(d.name===v){u=d.sort;break}}else if(f.every(d.pattern)){u=d.sort;break}c.col=l;var h,w=[],m={},y=0,b=0;for(p=0;p<c.table.tBodies.length;p++)for(h=0;h<c.table.tBodies[p].rows.length;h++)d=c.table.tBodies[p].rows[h],d.classList.contains("no-sort")?m[y]=d:w.push({tr:d,td:s(d.cells[c.col]),index:y}),y++;for("sort-down"===i?(w.sort(o(u,!0)),w.reverse()):w.sort(o(u,!1)),p=0;y>p;p++)m[p]?(d=m[p],b++):d=w[p-b].tr,c.table.tBodies[0].appendChild(d);c.table.dispatchEvent(t("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=e:window.Tablesort=e}(),function(){var e=function(e){return e.replace(/[^\-?0-9.]/g,"")},n=function(e,n){return e=parseFloat(e),n=parseFloat(n),e=isNaN(e)?0:e,n=isNaN(n)?0:n,e-n};Tablesort.extend("number",function(e){return e.match(/^-?[£\x24Û¢´€]?\d+\s*([,\.]\d{0,2})/)||e.match(/^-?\d+\s*([,\.]\d{0,2})?[£\x24Û¢´€]/)||e.match(/^-?(\d)*-?([,\.]){0,1}-?(\d)+([E,e][\-+][\d]+)?%?$/)},function(t,s){return t=e(t),s=e(s),n(s,t)})}();