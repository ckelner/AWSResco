function n(){O=[],M=[],clearInterval(_),_=null}function e(e,s,r){if(null!=e&&null!=s){if(P=r,f(),n(),-1!=r.indexOf(K))for(var a=0;a<k.length;a++)o(k[a],e,s,!1),o(k[a],e,s,!0);else o(P,e,s,!1),o(P,e,s,!0);_=setInterval(t,1e3)}}function t(){-1!=P.indexOf(K)?O.length==k.length&&M.length==k.length&&(clearInterval(_),l(r(O,M))):O.length>0&&M.length>0&&(clearInterval(_),l(r(O,M)))}function s(n){for(var e=n.length,t=[],s=0;e>s;s++)Array.prototype.push.apply(t,n[s].data);return t}function r(n,e){for(var t=s(n),r=s(e),o=r.length,a=[],i=0,c={},u=[],l=0;o>l;l++){var d=JSON.parse(JSON.stringify(r[l])),f=d.type+d.az+d.windows+d.vpc;if(!u.contains(f)){void 0===c[f]&&(c[f]=i,u.push(f),a[i]=JSON.parse(JSON.stringify(d)),i++);for(var p=l+1;o>p;p++){var v=JSON.parse(JSON.stringify(r[p]));d.type===v.type&&d.az===v.az&&d.windows===v.windows&&d.vpc===v.vpc&&l!==p&&v!==d&&(a[c[f]].count+=v.count,Array.prototype.push.apply(a[c[f]].resIds,v.resIds))}}}for(var g=t.length,h=0;g>h;h++){for(var w=a.length,m=t[h],y=!1,I=0;w>I;I++){var b=a[I];if(null==a[I].running&&(a[I].running=0,a[I].running_ids=[],a[I].running_names=[],a[I].diff=0-a[I].count),m.type==b.type&&m.az==b.az&&m.windows==b.windows&&m.vpc==b.vpc){a[I].running+=1,a[I].diff=a[I].count-a[I].running,a[I].running_ids.push(m.id),void 0!=m.name&&null!=m.name&&""!=m.name&&a[I].running_names.push(m.name),y=!0;break}}if(y===!1){var L={};L.running=1,L.running_ids=[m.id],L.running_names=[],void 0!=m.name&&null!=m.name&&""!=m.name&&L.running_names.push(m.name),L.diff=-1,L.resIds=[],L.type=m.type,L.count=0,L.az=m.az,L.cost=0,L.windows=m.windows,L.vpc=m.vpc,a.push(L)}}return a}function o(n,e,t,s){var r=new AWS.EC2({accessKeyId:e,secretAccessKey:t,region:n,maxRetries:5,sslEnabled:!0});if(s){var o={Filters:[{Name:"state",Values:["active"]}]};r.describeReservedInstances(o,function(e,t){a(e,t,n,s)})}else{var o={Filters:[{Name:"instance-state-name",Values:["running"]}],MaxResults:1e3};r.describeInstances(o,function(e,t){a(e,t,n,s)})}}function a(n,e,t,s){n?(console.log(n,n.stack),p("<b><font color='red'>The following error has occured: "+n+"; see the javascript console for more details.</font></b>")):i(e,t,s)}function i(n,e,t){t?M.push({region:e,data:c(n)}):O.push({region:e,data:u(n)})}function c(n){var e=[];if(!n||!n.ReservedInstances||0==n.ReservedInstances.length)return e;for(var t=n.ReservedInstances.length,s=0;t>s;s++)e[s]={},e[s].resIds=[n.ReservedInstances[s].ReservedInstancesId],e[s].type=n.ReservedInstances[s].InstanceType,e[s].count=n.ReservedInstances[s].InstanceCount,e[s].az=n.ReservedInstances[s].AvailabilityZone,e[s].cost=n.ReservedInstances[s].RecurringCharges[0].Amount,-1!=n.ReservedInstances[s].ProductDescription.toLowerCase().indexOf("windows")?e[s].windows=!0:e[s].windows=!1,-1!=n.ReservedInstances[s].ProductDescription.toLowerCase().indexOf("vpc")?e[s].vpc=!0:e[s].vpc=!1;return e}function u(n){var e=[];if(!n||!n.Reservations||0==n.Reservations.length)return e;for(var t=n.Reservations.length,s=0,r=0;t>r;r++)for(var o=0;o<n.Reservations[r].Instances.length;o++){var a=n.Reservations[r].Instances[o].Tags,i="";if(a.length>1)for(var c=a.length,u=0;c>u;u++)try{if(null!=a[u].Key)a[u].Key.toLowerCase()=="aws:autoscaling:groupName".toLowerCase()&&""==i&&(i=a[u].Value),"name"==a[u].Key.toLowerCase()&&(i=a[u].Value);else try{console.log("Tags["+u+"] empty: "+a.toString())}catch(n){console.log("Exception Id 00x1")}}catch(n){console.log("Exception Id 00x3")}else if(1==a.length)i=a[0].Value;else try{console.log("No name tag found for instance with id: "+n.Reservations[r].Instances[o].InstanceId)}catch(n){console.log("Exception Id 00x2")}e[s]={},e[s].name=i,e[s].id=n.Reservations[r].Instances[o].InstanceId,e[s].type=n.Reservations[r].Instances[o].InstanceType,e[s].az=n.Reservations[r].Instances[o].Placement.AvailabilityZone;try{void 0!=n.Reservations[r].Instances[o].Platform&&null!=n.Reservations[r].Instances[0].Platform&&"windows"==n.Reservations[r].Instances[o].Platform.toLowerCase()?e[s].windows=!0:e[s].windows=!1}catch(n){console.log("Exception Id 00x4")}null!=n.Reservations[r].Instances[o].VpcId&&""!=n.Reservations[r].Instances[o].VpcId?e[s].vpc=!0:e[s].vpc=!1,s++}return e}function l(n){R().innerHTML="",R().innerHTML+=v(n),w().innerHTML="<b>Total Reservations: "+F+" --- Total Running Instances: "+J+"<br><hr>",new Tablesort(document.getElementById("resCoTable")),I(),T()}function d(){for(var n="<form class='form-inline' id='zoneForm'>",e=0;e<D.length;e++)n+="<div class='checkbox'><label><input type='checkbox' name='"+D[e]+"'>"+D[e]+"</input></label></div>&nbsp;&nbsp;&nbsp;&nbsp;";return n+="<button id='zoneSelectButton' type='submit' class='btn btn-success'>Filter</button></form>"}function f(){B(),R().innerHTML="",w().innerHTML="",F=0,J=0}function p(n){R().innerHTML=n}function v(n){for(var e="",t=n.length,s=0;t>s;s++)e+="<tr><th scope='row'>"+n[s].count+"</th><td>"+n[s].running+"</th><td>"+n[s].diff+"</th><td>"+n[s].type+"</td><td>"+n[s].az+"</td><td>"+n[s].windows.toString()+"</td><td>"+n[s].vpc.toString()+"</td><td>"+n[s].running_ids.join(",<br/>")+"</td><td>"+n[s].running_names.join(",<br/>")+"</td></tr>",F+=n[s].count,J+=n[s].running,D.contains(n[s].az)||D.push(n[s].az);return e}function g(){V=setInterval(h,1e3)}function h(){-1==m().innerHTML.toLowerCase().indexOf("please wait.....")?m().innerHTML+=".":m().innerHTML="Please Wait"}function w(){return document.getElementById("totalData")}function m(){return document.getElementById("pleaseWait")}function y(){g(),m().style.display="block"}function I(){clearInterval(V),m().style.display="none"}function b(){return document.getElementById("errorAccessSecretKey")}function L(){I(),b().style.display="block"}function x(){b().style.display="none"}function R(){return document.getElementById("ec2DataTableBody")}function E(){return document.getElementById("awsQueryResults")}function T(){E().style.display="block"}function B(){E().style.display="none"}function C(){document.getElementById("awsQueryButton").addEventListener("click",function(){H()})}function A(n){return void 0==n||null==n||""==n?(L(),null):n}function S(){return A(document.getElementById("awsAccessKey").value)}function N(){return A(document.getElementById("awsSecretKey").value)}function z(){return document.getElementById("regionSelect").value}function H(){return y(),x(),e(S(),N(),z()),!1}var k=["us-east-1","us-west-1","us-west-2","eu-west-1","eu-central-1","ap-southeast-1","ap-southeast-2","ap-northeast-1","sa-east-1"],O=[],M=[],_=null,K="ALL",P="ALL",V=null,F=0,J=0,D=[];window.onload=function(){C()},Array.prototype.contains=function(n){for(var e=this.length;e--;)if(this[e]===n)return!0;return!1},!function(){function n(e,t){if(!(this instanceof n))return new n(e,t);if(!e||"TABLE"!==e.tagName)throw new Error("Element must be a table");this.init(e,t||{})}var e=[],t=function(n){var e;return window.CustomEvent&&"function"==typeof window.CustomEvent?e=new CustomEvent(n):(e=document.createEvent("CustomEvent"),e.initCustomEvent(n,!1,!1,void 0)),e},s=function(n){return n.getAttribute("data-sort")||n.textContent||n.innerText||""},r=function(n,e){return n=n.toLowerCase(),e=e.toLowerCase(),n===e?0:e>n?1:-1},o=function(n,e){return function(t,s){var r=n(t.td,s.td);return 0===r?e?s.index-t.index:t.index-s.index:r}};n.extend=function(n,t,s){if("function"!=typeof t||"function"!=typeof s)throw new Error("Pattern and sort must be a function");e.push({name:n,pattern:t,sort:s})},n.prototype={init:function(n,e){var t,s,r,o,a=this;if(a.table=n,a.thead=!1,a.options=e,n.rows&&n.rows.length>0&&(n.tHead&&n.tHead.rows.length>0?(t=n.tHead.rows[n.tHead.rows.length-1],a.thead=!0):t=n.rows[0]),t){var i=function(){a.current&&a.current!==this&&(a.current.classList.remove("sort-up"),a.current.classList.remove("sort-down")),a.current=this,a.sortTable(this)};for(r=0;r<t.cells.length;r++)o=t.cells[r],o.classList.contains("no-sort")||(o.classList.add("sort-header"),o.tabindex=0,o.addEventListener("click",i,!1),o.classList.contains("sort-default")&&(s=o));s&&(a.current=s,a.sortTable(s))}},sortTable:function(n,a){var i,c=this,u=n.cellIndex,l=r,d="",f=[],p=c.thead?0:1,v=n.getAttribute("data-sort-method"),g=n.getAttribute("data-sort-order");if(c.table.dispatchEvent(t("beforeSort")),a?i=n.classList.contains("sort-up")?"sort-up":"sort-down":(i=n.classList.contains("sort-up")?"sort-down":n.classList.contains("sort-down")?"sort-up":"asc"===g?"sort-down":"desc"===g?"sort-up":c.options.descending?"sort-up":"sort-down",n.classList.remove("sort-down"===i?"sort-up":"sort-down"),n.classList.add(i)),!(c.table.rows.length<2)){if(!v){for(;f.length<3&&p<c.table.tBodies[0].rows.length;)d=s(c.table.tBodies[0].rows[p].cells[u]),d=d.trim(),d.length>0&&f.push(d),p++;if(!f)return}for(p=0;p<e.length;p++)if(d=e[p],v){if(d.name===v){l=d.sort;break}}else if(f.every(d.pattern)){l=d.sort;break}c.col=u;var h,w=[],m={},y=0,I=0;for(p=0;p<c.table.tBodies.length;p++)for(h=0;h<c.table.tBodies[p].rows.length;h++)d=c.table.tBodies[p].rows[h],d.classList.contains("no-sort")?m[y]=d:w.push({tr:d,td:s(d.cells[c.col]),index:y}),y++;for("sort-down"===i?(w.sort(o(l,!0)),w.reverse()):w.sort(o(l,!1)),p=0;y>p;p++)m[p]?(d=m[p],I++):d=w[p-I].tr,c.table.tBodies[0].appendChild(d);c.table.dispatchEvent(t("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=n:window.Tablesort=n}(),function(){var n=function(n){return n.replace(/[^\-?0-9.]/g,"")},e=function(n,e){return n=parseFloat(n),e=parseFloat(e),n=isNaN(n)?0:n,e=isNaN(e)?0:e,n-e};Tablesort.extend("number",function(n){return n.match(/^-?[£\x24Û¢´€]?\d+\s*([,\.]\d{0,2})/)||n.match(/^-?\d+\s*([,\.]\d{0,2})?[£\x24Û¢´€]/)||n.match(/^-?(\d)*-?([,\.]){0,1}-?(\d)+([E,e][\-+][\d]+)?%?$/)},function(t,s){return t=n(t),s=n(s),e(s,t)})}();